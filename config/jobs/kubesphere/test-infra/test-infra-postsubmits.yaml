postsubmits:
  kubesphere/test-infra:
  - name: post-test-infra-deploy-prow
    run_if_changed: 'config/prow/cluster/.*'
    decorate: true
    branches:
    - ^main$
    max_concurrency: 1
    reporter_config:
      slack:
        channel: "prow"
        job_states_to_report:
        - success
        - failure
        - aborted
        - error
        report_template: 'Deploying prow: {{.Status.State}}. <{{.Spec.Refs.BaseLink}}|Commit {{.Spec.Refs.BaseSHA}}> <{{.Status.URL}}|View logs> <https://testgrid.k8s.io/sig-testing-prow#deploy-prow|Job history on Testgrid>'
    spec:
      serviceAccountName: deployer
      containers:
      - image: kubesphere/build-tools:master-latest
        command:
        - make
        - -C
        - config/prow
        - deploy

  - name: post-test-infra-update-config
    run_if_changed: '^config/(jobs/.*\.yaml$|prow/[\w_]*.yaml$)'
    decorate: true
    branches:
    - ^main$
    max_concurrency: 1
    reporter_config:
      slack:
        channel: "prow"
        job_states_to_report:
        - success
        - failure
        - aborted
        - error
        report_template: 'Update prow config: {{.Status.State}}. <{{.Spec.Refs.BaseLink}}|Commit {{.Spec.Refs.BaseSHA}}> <{{.Status.URL}}|View logs> <https://testgrid.k8s.io/sig-testing-prow#deploy-prow|Job history on Testgrid>'
    spec:
      serviceAccountName: deployer
      containers:
      - image: kubesphere/build-tools:master-latest
        command:
        - make
        - -C
        - config/prow
        - update-job-config
        - update-config
        - update-plugins
